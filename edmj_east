// Variables used by Scriptable.
// These must be at the very top of the file. Do not edit.
// icon-color: blue; icon-glyph: camera-retro;

let req = new Request('https://edmj.beck.space/east.jpg');
let image = await req.loadImage();

if (config.runsInWidget) {
  let widget = createWidget(image)
  Script.setWidget(widget)
  Script.complete()
} else { 	
  let widget = createWidget(image)
  await widget.presentMedium()
}

function createWidget(image) {

  const widget = new ListWidget()
  widget.backgroundColor = Color.black()
  widget.url = url
  widget.backgroundImage = image 

  widget.addSpacer()

  const titleText = widget.addText(getMetar())
  titleText.font = Font.boldSystemFont(12)
  titleText.textColor = Color.white()
  titleText.shadowRadius = 3
  titleText.shadowColor = Color.black()

  widget.addSpacer(2)

  const subtitleText = widget.addText('test')
  subtitleText.font = Font.systemFont(8)
  subtitleText.textColor = Color.white()
  subtitleText.textOpacity = 0.8
  subtitleText.shadowRadius = 3
  subtitleText.shadowColor = Color.black()

  return widget
}

function getMetar() {
  const url2 = "https://tgftp.nws.noaa.gov/data/observations/metar/stations/EDMA.TXT"
var req = new Request(url2)
var metar = await req.load()
  })
  return metar
}
